<div class="comments-container">
    <div class="comments-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-icon">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <h3>תגובות</h3>
        <span class="comments-count">{{ comments().length }}</span>
    </div>

    <div class="comments-list-scroll">
        @if (isLoading()) {
        <div class="loading-state">
            <div class="spinner"></div>
            <p>טוען שיחה...</p>
        </div>
        } @else {
        @if (comments().length === 0) {
        <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="#cbd5e0" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                <path
                    d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                </path>
            </svg>
            <p>אין תגובות עדיין. היו הראשונים להגיב!</p>
        </div>
        } @else {
        <div class="comments-list">
            @for (comment of comments(); track comment.id) {
           <div class="comment-item" 
     [class.own-comment]="isOwnComment(comment.user_id)">
                <div class="comment-bubble">
                    <div class="comment-meta">
                        <span class="user-name">
                            @if (comment.user_id === (authService.getCurrentUser() | async)?.id) {
                            {{ authService.getUserName() || 'אני' }}
                            } @else {
                            {{ getAuthorName(comment.user_id) }}
                            }
                        </span>
                       <span class="comment-date">{{ getLocalDate(comment.created_at) | date:'HH:mm' }}</span>
                    </div>
                    <p class="comment-body">{{ comment.body }}</p>
                </div>
            </div>
            }
        </div>
        }
        }
    </div>

    <div class="comment-form">
        <div class="input-wrapper">
            <textarea [formControl]="commentControl" placeholder="כתוב הודעה לצוות..." rows="1"
                (keydown)="onKeyDown($event)"></textarea>
            <button class="btn-send" (click)="onSubmitComment()" [disabled]="commentControl.invalid || isSubmitting()">
                @if (isSubmitting()) {
                <div class="mini-spinner"></div>
                } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
                }
            </button>
        </div>
        <small class="form-hint">Ctrl + Enter לשליחה מהירה</small>
    </div>
</div>